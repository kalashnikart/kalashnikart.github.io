/*! For license information please see app.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkaframe_three_bridge=self.webpackChunkaframe_three_bridge||[]).push([["app"],{"./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/style.sass":(n,t,e)=>{e.r(t),e.d(t,{default:()=>A});var i=e("./node_modules/css-loader/dist/runtime/sourceMaps.js"),s=e.n(i),r=e("./node_modules/css-loader/dist/runtime/api.js"),o=e.n(r)()(s());o.push([n.id,"* {\n  margin: 0;\n}\n\nbody {\n  margin: 0;\n  height: 100vh;\n  width: 100vw;\n  overflow: hidden;\n}\n\n#unity-container {\n  position: fixed;\n  z-index: 998;\n  left: 0;\n  top: 0;\n  width: 100vw;\n  height: 100vh;\n}\n\n#container {\n  display: none;\n  opacity: 0;\n  height: 100vh;\n}\n#container video, #container canvas {\n  display: none;\n  opacity: 0;\n}\n\n.scan-box {\n  height: 100%;\n  width: 100%;\n  max-width: 100vw;\n  max-height: 100vh;\n  display: flex;\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.scan-region {\n  margin: auto;\n  width: 400px;\n  height: 400px;\n  border: 2px solid red;\n}\n\n.qr-container {\n  position: relative;\n  height: 100vh;\n  width: 100vw;\n  z-index: 0;\n  overflow: hidden;\n}\n.qr-container video {\n  transform: translate(-50%, -50%) !important;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  min-width: 100%;\n  min-height: 100%;\n  width: auto;\n  height: auto;\n  z-index: -1;\n}\n.qr-container .scan-region-highlight {\n  top: 50% !important;\n  left: 50% !important;\n  transform: translate(-50%, -50%) !important;\n  background: yellow;\n  opacity: 0.5;\n}\n.qr-container .scan-region-highlight svg {\n  opacity: 0;\n  display: none;\n}\n\n.logs {\n  transform: translate(0, 0);\n  right: 10px;\n  top: 10px;\n  background: #000;\n  color: #fff;\n  font-size: 2rem;\n}\n\n@media (orientation: portrait) {\n  .qr-container video {\n    transform-origin: 50% 50%;\n  }\n  .qr-container canvas {\n    left: 50%;\n    top: 50%;\n    transform-origin: 50% 50%;\n    transform: translate(-50%, -50%);\n    max-width: min(100vw, 100vh);\n    max-height: min(100vw, 100vh);\n  }\n}","",{version:3,sources:["webpack://./src/style.sass"],names:[],mappings:"AAAA;EACE,SAAA;AACF;;AACA;EACE,SAAA;EACA,aAAA;EACA,YAAA;EACA,gBAAA;AAEF;;AAAA;EACE,eAAA;EACA,YAAA;EACA,OAAA;EACA,MAAA;EACA,YAAA;EACA,aAAA;AAGF;;AADA;EACE,aAAA;EACA,UAAA;EAEA,aAAA;AAGF;AAAE;EACE,aAAA;EACA,UAAA;AAEJ;;AAAA;EACE,YAAA;EACA,WAAA;EACA,gBAAA;EACA,iBAAA;EACA,aAAA;EACA,kBAAA;EACA,OAAA;EACA,MAAA;AAGF;;AADA;EACE,YAAA;EACA,YAAA;EACA,aAAA;EACA,qBAAA;AAIF;;AAFA;EACE,kBAAA;EACA,aAAA;EACA,YAAA;EACA,UAAA;EACA,gBAAA;AAKF;AAHE;EACE,2CAAA;EACA,kBAAA;EACA,QAAA;EACA,SAAA;EACA,eAAA;EACA,gBAAA;EACA,WAAA;EACA,YAAA;EACA,WAAA;AAKJ;AAHE;EACE,mBAAA;EACA,oBAAA;EACA,2CAAA;EACA,kBAAA;EACA,YAAA;AAKJ;AAJI;EACE,UAAA;EACA,aAAA;AAMN;;AAJA;EACE,0BAAA;EACA,WAAA;EACA,SAAA;EACA,gBAAA;EACA,WAAA;EACA,eAAA;AAOF;;AALA;EAEI;IACE,yBAAA;EAOJ;EALE;IACE,SAAA;IACA,QAAA;IACA,yBAAA;IAEA,gCAAA;IACA,4BAAA;IACA,6BAAA;EAMJ;AACF",sourcesContent:["*\n  margin: 0\n\nbody\n  margin: 0\n  height: 100vh\n  width: 100vw\n  overflow: hidden\n\n#unity-container\n  position: fixed\n  z-index: 998\n  left: 0\n  top: 0\n  width: 100vw\n  height: 100vh\n\n#container\n  display: none\n  opacity: 0\n  // width: 100vw\n  height: 100vh\n  // position: relative\n  // overflow: hidden\n  video, canvas\n    display: none\n    opacity: 0\n\n.scan-box\n  height: 100%\n  width: 100%\n  max-width: 100vw\n  max-height: 100vh\n  display: flex\n  position: absolute\n  left: 0\n  top: 0\n\n.scan-region\n  margin: auto\n  width: 400px\n  height: 400px\n  border: 2px solid red\n\n.qr-container\n  position: relative\n  height: 100vh\n  width: 100vw\n  z-index: 0\n  overflow: hidden\n\n  video\n    transform: translate(-50%, -50%) !important\n    position: absolute\n    top: 50%\n    left: 50%\n    min-width: 100%\n    min-height: 100%\n    width: auto\n    height: auto\n    z-index: -1\n\n  .scan-region-highlight\n    top: 50% !important\n    left: 50% !important\n    transform: translate(-50%,-50%) !important\n    background: yellow\n    opacity: .5\n    svg\n      opacity: 0\n      display: none\n\n.logs\n  transform: translate(0,0)\n  right: 10px\n  top: 10px\n  background: #000\n  color: #fff\n  font-size: 2rem\n\n@media (orientation: portrait)\n  .qr-container\n    video\n      transform-origin: 50% 50%\n      // transform: translate(-50%, -50%) scale(.7) !important\n    canvas\n      left: 50%\n      top: 50%\n      transform-origin: 50% 50%\n      // transform: translate(-50%, -50%) scale(.35)\n      transform: translate(-50%, -50%)\n      max-width: min(100vw, 100vh)\n      max-height: min(100vw, 100vh)\n"],sourceRoot:""}]);const A=o},"./src/style.sass":(n,t,e)=>{e.r(t),e.d(t,{default:()=>E});var i=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),s=e.n(i),r=e("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),o=e.n(r),A=e("./node_modules/style-loader/dist/runtime/insertBySelector.js"),a=e.n(A),d=e("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),l=e.n(d),h=e("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),c=e.n(h),u=e("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),m=e.n(u),v=e("./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/style.sass"),y={};y.styleTagTransform=m(),y.setAttributes=l(),y.insert=a().bind(null,"head"),y.domAPI=o(),y.insertStyleElement=c(),s()(v.default,y);const E=v.default&&v.default.locals?v.default.locals:void 0},"./src/index.ts":(n,t,e)=>{e.r(t),e("./src/style.sass");var i=e("./src/qr.ts"),s=e("./src/mindar.ts");let r="";const o=new s.default;o.init().then((()=>{(new i.default).scan().then((n=>{n.subscribe((n=>{const t=n.split("/").reverse()[0];r!==t&&(r=t,o.setMindAR(t))}))}))}))},"./src/mindar.ts":(n,t,e)=>{e.r(t),e.d(t,{default:()=>o}),e("./src/style.sass");var i=e("./src/unity.ts"),s=e("./src/three2unity.ts"),r=function(n,t,e,i){return new(e||(e=Promise))((function(s,r){function o(n){try{a(i.next(n))}catch(n){r(n)}}function A(n){try{a(i.throw(n))}catch(n){r(n)}}function a(n){var t;n.done?s(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(o,A)}a((i=i.apply(n,t||[])).next())}))};window.MINDAR.IMAGE.THREE;class o{constructor(){this.rendering=!1,this.mindid="Test",this.started=!1,this.onTargetFound=()=>{this.unity.setVisible(),this.unity.msg("SetText",this.mindid),this.rendering=!0,this.render()},this.onTargetLost=()=>{this.unity.setInvisible(),this.rendering=!1},this.render=()=>{this.rendering&&(this.renderLoopCB(),requestAnimationFrame(this.render))},this.renderLoopCB=()=>{this.unity.msg("SetCubeFromTHREEJS",(0,s.serializeMatrix4x4)(this.anchor.group.matrix))}}init(){return r(this,void 0,void 0,(function*(){this.unity=new i.Unity,yield this.unity.init(),this.unity.setInvisible()}))}kill(){var n,t;this.rendering=!1,document.querySelectorAll(".mindar-ui-overlay").forEach((n=>document.body.removeChild(n))),this.unity.setInvisible(),null===(n=this.mindarThree)||void 0===n||n.stop(),null===(t=this.renderer)||void 0===t||t.dispose(),this.anchor&&(this.anchor.onTargetFound=null,this.anchor.onTargetLost=null,this.anchor=null),this.renderer=null,this.scene=null,this.camera=null,this.mindarThree=null}resetTarget(n){return r(this,void 0,void 0,(function*(){this.mindid=n,this.mindarThree.stop(),this.mindarThree.imageTargetSrc=`./targets/${n}.mind`,yield this.runMindAR(),this.unity.setInvisible()}))}setMindAR(n){var t;return r(this,void 0,void 0,(function*(){this.started?this.resetTarget(n):(this.mindid=n,this.kill(),this.mindarThree=new window.MINDAR.IMAGE.MindARThree({container:document.querySelector("#container"),imageTargetSrc:`./targets/${n}.mind`,colorSpace:"sRGB",renderer:"colorManagement: true, physicallyCorrectLights",uiError:"no",uiScanning:"no"}),this.renderer=this.mindarThree.renderer,this.scene=this.mindarThree.scene,this.camera=this.mindarThree.camera,this.anchor=this.mindarThree.addAnchor(0),this.camera&&(null===(t=this.scene)||void 0===t||t.add(this.camera)),this.anchor.onTargetFound=this.onTargetFound,this.anchor.onTargetLost=this.onTargetLost,yield this.runMindAR(),this.unity.setInvisible())}))}runMindAR(){return r(this,void 0,void 0,(function*(){yield this.mindarThree.start(),this.render()}))}}},"./src/qr.ts":(n,t,e)=>{e.r(t),e.d(t,{default:()=>r});var i=e("./node_modules/qr-scanner/qr-scanner.min.js"),s=e("./node_modules/rxjs/dist/esm5/internal/Subject.js");class r{constructor(){this.video=document.getElementById("qr-video"),this.result=new s.Subject,this.onDecode=n=>{this.result.next(n.data)},this.scan=()=>{return n=this,t=void 0,i=function*(){return yield this.scanner.start(),this.result},new((e=void 0)||(e=Promise))((function(s,r){function o(n){try{a(i.next(n))}catch(n){r(n)}}function A(n){try{a(i.throw(n))}catch(n){r(n)}}function a(n){var t;n.done?s(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(o,A)}a((i=i.apply(n,t||[])).next())}));var n,t,e,i},this.scanner=new i.default(this.video,this.onDecode,{maxScansPerSecond:4})}destroy(){var n;this.scanner.stop(),this.scanner.destroy();const t=document.querySelector(".qr-container");null===(n=t.parentElement)||void 0===n||n.removeChild(t)}}},"./src/three2unity.ts":(n,t,e)=>{e.r(t),e.d(t,{ConvertThreejsEulerToUnity:()=>s,serializeMatrix4x4:()=>r});const i=window.MINDAR.IMAGE.THREE,s=n=>{n.x*=-1,n.z*=-1;const t=(n=>{const t=Math.cos(n.x),e=Math.cos(n.y),s=Math.cos(n.z),r=Math.sin(n.x),o=Math.sin(n.y),A=Math.sin(n.z),a=new i.Matrix4;return a.elements[0]=e*s,a.elements[1]=-e*A,a.elements[2]=o,a.elements[4]=t*A+s*r*o,a.elements[5]=t*s-r*o*A,a.elements[6]=-e*r,a.elements[8]=r*A-t*s*o,a.elements[9]=s*r+t*o*A,a.elements[10]=t*e,a.elements[15]=1,a})(n);t.elements[2]*=-1,t.elements[6]*=-1,t.elements[8]*=-1,t.elements[9]*=-1;let e=(new i.Quaternion).setFromRotationMatrix(t);return e.w*=-1,e},r=n=>{const t=(new i.Vector3).setFromMatrixPosition(n),e=(new i.Quaternion).setFromRotationMatrix(n),s=(new i.Euler).setFromQuaternion(e,"XYZ"),r=(new i.Vector3).setFromMatrixScale(n).multiplyScalar(.5);return[`${s.x},${s.y},${s.z}`,`${-t.x},${t.y},${t.z}`,`${r.x},${r.y},${r.z}`].join(",")}},"./src/unity.ts":(n,t,e)=>{e.r(t),e.d(t,{Unity:()=>r});var i=e("./src/utils.ts");const s={dataUrl:"Build/pr1.data",frameworkUrl:"Build/pr1.framework.js",codeUrl:"Build/pr1.wasm"};class r{constructor(){this.canvas=document.querySelector("#unity-canvas")}init(){return n=this,t=void 0,r=function*(){yield(0,i.loadScript)("Build/pr1.loader.js"),this.unityInstance=yield createUnityInstance(this.canvas,s)},new((e=void 0)||(e=Promise))((function(i,s){function o(n){try{a(r.next(n))}catch(n){s(n)}}function A(n){try{a(r.throw(n))}catch(n){s(n)}}function a(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(o,A)}a((r=r.apply(n,t||[])).next())}));var n,t,e,r}msg(n,t){var e;null===(e=this.unityInstance)||void 0===e||e.SendMessage("NewBehaviourScript",n,t)}setVisible(){var n;null===(n=this.unityInstance)||void 0===n||n.SendMessage("Main Camera","SetVisible")}setInvisible(){var n;null===(n=this.unityInstance)||void 0===n||n.SendMessage("Main Camera","SetInvisible")}}},"./src/utils.ts":(n,t,e)=>{function i(n){return new Promise((function(t,e){const i=document.createElement("script");i.src=n,i.onload=t,i.onerror=e,document.body.appendChild(i)}))}e.r(t),e.d(t,{loadScript:()=>i})}},n=>{n.O(0,["vendors-node_modules_css-loader_dist_runtime_api_js-node_modules_css-loader_dist_runtime_sour-fea0cf"],(()=>("./src/index.ts",n(n.s="./src/index.ts")))),n.O()}]);
//# sourceMappingURL=app.bundle.js.map